(function(b){var f={};"undefined"===typeof Function.prototype.bind&&(Function.prototype.bind=function(e){var c=this;return function(){return c.apply(e||null,Array.prototype.slice.call(arguments))}});f.module=function(e){var c=Array.prototype.slice.call(arguments,1);return e.apply(b,[b.genera,b.jQuery,b].concat(c))};f.events={TRANSITION:"webkitTransitionEnd transitionend",MOUSEMOVE:"mousemove",MOUSEUP:"mouseup",MOUSEDOWN:"mousedown",CLICK:"click",KEYUP:"keyup",KEYDOWN:"keydown"};f.classNames={DRAGGING:"dragging",
OPEN:"open",ANIMATE:"animate",POSITIONS:"far-previous previous current next far-next forward backward"};b.genera=f})(window);
genera.module(function(b){function f(){}function e(){}f.inherit=function(c,b){b=b||f;b.call(c);e.mix(c);c.prototype=new b;c.inherit=b.inherit};e.prototype.onAttach=function(){};e.prototype.onDetach=function(){};e.prototype.onAdd=function(){};e.prototype.onRemove=function(){};e.prototype.onClone=function(){};e.prototype.onLeave=function(){};e.prototype.onEnter=function(){};e.prototype.toJSON=function(){return this};e.mix=function(c){"Attach Detach Add Remove Clone Leave Enter".split(" ").forEach(function(b){c.prototype["on"+
b]=this.prototype["on"+b]}.bind(this));c.prototype.toJSON=this.prototype.toJSON};b.Mixins=e;b.Base=f});
genera.module(function(b,f,e){function c(i){i.container.on(a.TRANSITION,function(){f(this).off(a.TRANSITION);i.onEnter.call(i)})}function j(i){i.container.on(a.TRANSITION,function(){f(this).off(a.TRANSITION);i.onLeave.call(i)})}function d(i){i=i||{};this.container=i.container;this.container.addClass(g.ANIMATE);this.workspaces=[];this.currentWorkspace=0}var a=b.events,g=b.classNames,h=g.POSITIONS.split(" ").reduce(function(i,a){i[a.toUpperCase().replace("-","_")]=a;return i},{});d.prototype.loadWorkspaces=
function(i){var a=[],c;for(c in e.localStorage)c.match(/^workspace:/)&&a.push(e.JSON.parse(e.localStorage[c]));i(a)};d.prototype.cleanupCurrentWorkspace=function(){this.getCurrentWorkspace().cleanupPanels()};d.prototype.cloneCurrentWorkspace=function(){var a=this.getCurrentWorkspace().clone();a.id="workspace-"+(new Date).getTime();a.setName(a.name+" Copy");this.addWorkspace(a);this.goToWorkspace(a)};d.prototype.saveCurrentWorkspace=function(){this.getCurrentWorkspace().save()};d.prototype.addWorkspace=
function(a){a.attach(this.container);a.setID(a.id||"workspace-"+(new Date).getTime());this.workspaces.push(a)};d.prototype.removeWorkspace=function(a){a.remove();a=this.workspaces.indexOf(a);this.workspaces.splice(a,1);this.currentWorkspace=a>this.workspaces.length-1?a-1:a;c(this.workspaces[this.currentWorkspace]);this.moveToCurrentWorkspace()};d.prototype.getCurrentWorkspaceNum=function(){return this.currentWorkspace};d.prototype.getCurrentWorkspace=function(){return this.workspaces[this.currentWorkspace]};
d.prototype.moveToCurrentWorkspace=function(){this.workspaces.map(function(a){a.resetPosition()});this.workspaces[this.currentWorkspace-2]&&this.workspaces[this.currentWorkspace-2].setPosition(h.FAR_PREVIOUS);this.workspaces[this.currentWorkspace-1]&&this.workspaces[this.currentWorkspace-1].setPosition(h.PREVIOUS);this.workspaces[this.currentWorkspace].setPosition(h.CURRENT);this.workspaces[this.currentWorkspace+1]&&this.workspaces[this.currentWorkspace+1].setPosition(h.NEXT);this.workspaces[this.currentWorkspace+
2]&&this.workspaces[this.currentWorkspace+2].setPosition(h.FAR_NEXT)};d.prototype.goToWorkspace=function(a){a instanceof b.Workspace&&-1!==this.workspaces.indexOf(a)?this.skipToWorkspace(this.workspaces.indexOf(a)):0<=a&&a<this.workspaces.length&&(a=parseInt(a,10),1<Math.abs(a-this.currentWorkspace)?this.skipToWorkspace(a):(j(this.workspaces[this.currentWorkspace]),this.currentWorkspace=a,c(this.workspaces[this.currentWorkspace]),this.moveToCurrentWorkspace()))};d.prototype.skipToWorkspace=function(c){c=
parseInt(c,10);this.container.removeClass(g.ANIMATE);var b,d;this.workspaces.forEach(function(a,g){a===this.workspaces[this.currentWorkspace]?(a.setPosition(h.CURRENT),b=a):a.resetPosition();g===c&&(a.setPosition(h.FORWARD),d=a)}.bind(this));b&&d&&(this.container.addClass(g.ANIMATE),d.container.on(a.TRANSITION,function(){this.container.removeClass(g.ANIMATE);this.moveToCurrentWorkspace();this.container.addClass(g.ANIMATE);d.container.off(a.TRANSITION);d.onEnter.call(d)}.bind(this)),b.container.on(a.TRANSITION,
function(){b.container.off(a.TRANSITION);b.onLeave.call(b)}.bind(this)),e.setTimeout(function(){b.setPosition(h.BACKWARD);d.setPosition(h.CURRENT);this.currentWorkspace=c}.bind(this),15))};d.prototype.nextWorkspace=function(){this.currentWorkspace<this.workspaces.length-1&&(j(this.workspaces[this.currentWorkspace]),this.currentWorkspace+=1,c(this.workspaces[this.currentWorkspace]));this.moveToCurrentWorkspace()};d.prototype.previousWorkspace=function(){0<this.currentWorkspace&&(j(this.workspaces[this.currentWorkspace]),
this.currentWorkspace-=1,c(this.workspaces[this.currentWorkspace]));this.moveToCurrentWorkspace()};d.prototype.toJSON=function(){return e.JSON.stringify({})};d.POSITIONS=h;b.WorkspaceManager=d});
genera.module(function(b,f,e){function c(a){a=a||{};this.id=a.id;this.name=a.name;this.fromStore=a.fromStore;this.layout=a.layout||new b.Layout({});this.panels=[];this.container=f('<div class="workspace"></div>')}var j=b.events,d=b.classNames.POSITIONS.split(" ").reduce(function(a,c){a[c.toUpperCase().replace("-","_")]=c;return a},{});b.Mixins.mix(c);c.prototype.isVisible=function(){return this.container.hasClass(d.CURRENT)};c.prototype.setName=function(a){this.name=a};c.prototype.setID=function(a){this.id=
a;this.container.append('<h4 contenteditable="true" spellcheck="false">'+(this.name||this.id)+"</h4>");this.container.attr("data-id",a)};c.prototype.resetPosition=function(){this.container.removeClass(b.classNames.POSITIONS)};c.prototype.setPosition=function(a){this.resetPosition();this.container.addClass(a)};c.prototype.addPanel=function(a){a.workspace=this;a.attach(this.container);this.panels.push(a);this.cleanupPanels();a.reveal()};c.prototype.getPanel=function(a){for(var c=0;c<this.panels.length;c++)if(this.panels[c].id===
a)return this.panels[c];return null};c.prototype.cleanupPanels=function(){this.layout.adjust(this.panels)};c.prototype.panelToTop=function(a){this.panels.map(function(c){c===a?c.container.css({zIndex:99}):c.container.css({zIndex:98})})};c.prototype.removePanel=function(a){a.hide(function(){a.remove();this.panels.splice(this.panels.indexOf(a),1);this.cleanupPanels();this.fromStore&&this.save()}.bind(this))};c.prototype.attach=function(a){a.append(this.container);this.onAttach.call(this)};c.prototype.remove=
function(){this.container.on(j.TRANSITION,function(){for(var a;a=this.panels.shift();)a.remove();this.container.off();this.container.remove();this.onRemove.call(this);e.localStorage.removeItem("workspace:"+this.id)}.bind(this));this.container.removeClass(d.CURRENT).addClass(d.BACKWARD)};c.prototype.clone=function(){var a=new c(this);this.panels.forEach(function(c){a.addPanel(c.clone())});this.onClone.call(this);return a};c.prototype.onEnter=function(){this.panels.forEach(function(a){a.onEnter.call(a)})};
c.prototype.onLeave=function(){this.panels.forEach(function(a){a.onLeave.call(a)})};c.prototype.save=function(){this.fromStore=!0;e.localStorage.setItem("workspace:"+this.id,e.JSON.stringify(this.toJSON()))};c.prototype.toJSON=function(){var a={id:this.id,name:this.name,layout:this.layout.toJSON()};a.panels=this.panels.map(function(a){return a.toJSON()});return a};b.Workspace=c});
genera.module(function(b,f,e){function c(b){f(e).off(g.MOUSEUP,c).off(g.MOUSEMOVE,j);a&&(a.container.removeClass(h.DRAGGING),f(document.body).removeClass(h.DRAGGING),a.onDragEnd(b),a=null)}function j(c){var b=a.workspace.container.offset(),d=c.clientY-b.top-a.offsetY,b=c.clientX-b.left-a.offsetX;a.setPosition({x:10<b?b:10,y:60<d?d:60});a.onDrag(c)}function d(b){b&&(b=b||{},this.id=b.id||"panel-"+(new Date).getTime(),this.workspace=b.workspace,this.container=f('<div class="panel"></div>'),this.container.attr("id",
this.id),this.x=b.x||0,this.y=b.y||0,this.offsetY=this.offsetX=0,this.container.on(g.CLICK,".remove",function(){this.workspace.removePanel(this);return!1}.bind(this)),this.container.on(g.MOUSEDOWN,".draghandle",function(b){var d=f(b.target);a=this;a.offsetX=b.offsetX||b.pageX-d.offset().left;a.offsetY=b.offsetY||b.pageY-d.offset().top;a.container.addClass(h.DRAGGING);a.workspace.panelToTop(a);f(e).on(g.MOUSEUP,c).on(g.MOUSEMOVE,j);f(document.body).addClass(h.DRAGGING);a.onDragStart(b)}.bind(this)).on(g.MOUSEUP,
".draghandle",c));return this}var a,g=b.events,h=b.classNames;b.Mixins.mix(d);d.prototype.attach=function(a){a.append(this.container);this.onAttach.call(this)};d.prototype.setPosition=function(a){this.x=a.x||0;this.y=a.y||0;this.container.css({left:this.x,top:this.y})};d.prototype.remove=function(){this.container.off();this.container.remove();this.onRemove.call(this)};d.prototype.reveal=function(){e.setTimeout(function(){this.container.addClass(h.OPEN)}.bind(this),15)};d.prototype.hide=function(a){if(a)this.container.on(g.TRANSITION,
function(){this.container.off(g.TRANSITION);a()}.bind(this));this.container.removeClass(h.OPEN)};d.prototype.clone=function(){var a=new d(this);this.onClone.call(this);return a};d.prototype.onDrag=function(){};d.prototype.onDragEnd=function(){};d.prototype.onDragStart=function(){};d.prototype.toJSON=function(){return{id:this.id,x:this.x,y:this.y}};b.Panel=d});
genera.module(function(b){function f(){}b.Mixins.mix(f);f.prototype.adjust=function(b){b.forEach(function(b,e){b.setPosition({x:480*Math.floor(e%3)+20,y:280*Math.floor(e/3)+80})})};b.Layout=f});
